# INFERENCE CONFIG
app: vjepa
cpus_per_task: 32
# Output folder for inference logs
folder: /home/sagemaker-user/user-default-efs/vjepa2/evals/vitg-384/lvef_inference
mem_per_gpu: 80G
nodes: 1
tasks_per_node: 8
num_workers: 8

# Use existing evaluation infrastructure
eval_name: video_classification_frozen
resume_checkpoint: true # <--- CRITICAL: Must be true to load probe
tag: lvef-a4c-panecho-224px-inference

# --- CRITICAL INFERENCE SETTINGS ---
val_only: true
# Path where the predictions CSV will be saved
predictions_save_path: /home/sagemaker-user/user-default-efs/vjepa2/preds/lvef-a4c-panecho-224px_predictions.csv

# POINT THIS TO YOUR TRAINED PROBE CHECKPOINT
probe_checkpoint: /home/sagemaker-user/user-default-efs/vjepa2/checkpoints/eval_probes/lvef/panecho_224px.pt

experiment:
  classifier:
    task_type: regression
    num_heads: 16
    num_probe_blocks: 4
    num_targets: 1

  data:
    dataset_type: VideoDataset
    # Point 'dataset_val' to your TEST CSV
    dataset_val:   /home/sagemaker-user/user-default-efs/vjepa2/data/csv/a4c_b_lvef_test_224px.csv
    # Dummy path for train (ignored but required by parser)
    dataset_train: /home/sagemaker-user/user-default-efs/vjepa2/data/csv/a4c_b_lvef_test_224px.csv
    
    resolution: 224
    frames_per_clip: 16
    frame_step: 2
    num_segments: 2
    num_views_per_segment: 1

    # NOTE: Your training config did NOT specify normalization.
    # This means it used the default ImageNet normalization defined in eval.py.
    # We omit the normalization block here to match training behavior.

    # Regression Un-normalization stats (LVEF)
    target_mean: 57.06
    target_std: 11.33

  optimization:
    # Increase batch size for inference
    batch_size: 4
    
    # Zero out learning rates (safety)
    multihead_kwargs:
    - final_lr: 0.0
      final_weight_decay: 0.0
      lr: 0.0
      start_lr: 0.0
      warmup: 0.0
      weight_decay: 0.0

    num_epochs: 1
    use_bfloat16: true
    use_pos_embed: false

model_kwargs:
  checkpoint: null # PanEcho typically handles its own weights
  module_name: evals.video_classification_frozen.modelcustom.panecho_encoder
  pretrain_kwargs: {}
  wrapper_kwargs: {}